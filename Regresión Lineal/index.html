<!DOCTYPE html>
<html lang="en">

<head>
     <meta charset="UTF-8">
     <meta http-equiv="X-UA-Compatible" content="IE=edge">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Regresi√≥n lineal</title>

     <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.4.1/p5.min.js"></script>

     <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css">
     <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>

<body>

     <style>
          body,
          html {
               margin: 0;
               padding: 0;
          }

          @font-face {
               font-family: myFirstFont;
               src: url(https://cdn.jsdelivr.net/gh/Jeff-Aporta/recursos@5e3f65ccc8059bea40436df5ce162da8abe213a0/lmroman.ttf);
          }

          #resumen {
               font-family: myFirstFont;
               font-size: 160%;
               font-weight: bolder;
               text-align: left;
          }

          table {
               display: inline-block;
               font-family: myFirstFont;
               font-size: 130%;
               border: 1px solid black;
               vertical-align: top;
          }

          th,
          td {
               padding: 2px;
               border: 1px solid black;
          }

          td {
               background-color: white;
               font-size: 80%;
          }

          th {
               background: rgb(0, 139, 105);
               color: white;
          }

          body {
               text-align: center;
          }

          canvas {
               border: 2px solid rgb(0, 139, 105);
          }

          .stop-scrolling {
               height: 100%;
               overflow: hidden;
          }

          input {
               text-align: center;
          }

          .fondo {
               background-image: url(https://i.ibb.co/wYp0Dc9/banner.gif);
               background-position: center;
               background-repeat: no-repeat;
               background-size: cover;
          }

          .fondo2 {
               background-image: url(https://i.ibb.co/gD4Hzm2/dots2.gif);
               background-position: center;
               background-repeat: no-repeat;
               background-size: cover;
          }
     </style>

     <div class="fondo" id="encabezado">
          <div style="background: linear-gradient(to bottom,rgba(255, 255, 255, 0.7),white);text-align: center;">
               <img src="https://i.ibb.co/0QpGMLH/regresi-n.png"
                    style="mix-blend-mode: multiply;width: 90%;max-width: 512px;margin-top: -30px;">
               <br>
               <img src="https://latex.codecogs.com/png.image?\dpi{150}a=\frac{n\sum&space;xy-\sum&space;x\sum&space;y}{n\sum&space;x^2-(\sum&space;x)^2}"
                    style="margin: 20px;">
               <img src="https://latex.codecogs.com/png.image?\dpi{150}b&space;=&space;\frac{\sum&space;y-a\sum&space;x}{n}"
                    style="margin: 20px;">
               <img src="https://latex.codecogs.com/png.latex?\dpi{150}y = ax+b" style="margin: 20px;">
               <br>
               <br>
          </div>
     </div>

     <div class="fondo2">
          <div style="background: rgba(255, 255, 255, 0.95);">
               Cantidad de muestras: <input type="number" step="1" min="1" max="100" value="1" id="cantidad"
                    onchange="actualizarDatosTablaHTML()" onkeyup="actualizarDatosTablaHTML()">

               <br>
               <br>

               <table cellpadding="0" cellspacing="0" style="margin: 10px;">
                    <thead>
                         <tr>
                              <th colspan="3" style="background: black;font-size: 150%;">
                                   Muestreo
                              </th>
                         </tr>
                         <tr>
                              <th>
                                   x
                              </th>
                              <th>
                                   y
                              </th>
                         </tr>
                    </thead>
                    <tbody id="dispersion">
                         <tr>
                              <td colspan="2" style="background: black;" onclick="randomizarPuntosDispersos()">
                                   <span class="btn btn-primary">
                                        <i class="fas fa-random"></i>
                                   </span>
                              </td>
                         </tr>
                    </tbody>
               </table>

               <div id="contenedor-canvas" style="display: inline-block;margin: 10px;">
               </div>

               <div style="display: inline-block;vertical-align: top;" id="resumen">
               </div>
          </div>
     </div>


     <div class="fondo">
          <div
               style="background: linear-gradient(to top,rgba(255, 255, 255, 0.5),white);padding: 30px;font-weight: bolder;font-size: 130%;">
               Desarrollado por Jeffrey Agudelo
               <br>
               <a class="btn btn-light" target="_blank" href="https://www.youtube.com/c/JeffAportaa"
                    style="text-decoration: none;color: inherit;font-weight: normal;box-shadow: 3px 3px 3px rgba(0, 0, 0, 0.5);margin: 5px;">
                    <i class="fab fa-youtube" style="color: red;"></i> Jeff Aporta
               </a>
          </div>
     </div>


     <script>

          ESCALA = 30
          TX = 0
          TY = 0

          focusCanvas = false

          function setup() {
               canvas = createCanvas(500, 500)
               canvas.id("canvas")
               canvas.parent("contenedor-canvas")
               TX = width * 0.1
               TY = height * 0.5
               windowResized()
          }

          function windowResized() {
               if (windowWidth < 600) {
                    resizeCanvas(300, 300)
               } else {
                    resizeCanvas(500, 500)
               }
          }

          function mousePressed() {
               if (mouseInCanvas()) {
                    focusCanvas = true
                    disableScroll()
               }
          }
          function mouseReleased() {
               if (!mouseInCanvas()) {
                    focusCanvas = false
                    enableScroll()
               }
          }

          function mouseDragged() {
               focusCanvas = true
               if (mouseInCanvas()) {
                    disableScroll()
                    TX += mouseX - pmouseX
                    TY += mouseY - pmouseY
               }
          }

          function mouseWheel(event) {
               if (focusCanvas) {
                    ESCALA += event.delta / 20
                    ESCALA = constrain(ESCALA, 5, 200)
               }
          }

          function mouseInCanvas() {
               return mouseX > 0 && mouseY > 0 && mouseX < width && mouseY < height
          }

          function disableScroll() {
               document.body.classList.add("stop-scrolling");
          }

          function enableScroll() {
               document.body.classList.remove("stop-scrolling");
          }

          function draw() {
               background("white")
               translate(TX, TY)
               if (focusCanvas) {
                    if (keyIsDown(RIGHT_ARROW)) {
                         TX += 2
                    }
                    if (keyIsDown(LEFT_ARROW)) {
                         TX -= 2
                    }
                    if (keyIsDown(UP_ARROW)) {
                         TY -= 2
                    }
                    if (keyIsDown(DOWN_ARROW)) {
                         TY += 2
                    }
               }
               stroke("black")
               fill("black")
               line(-TX, 0, -TX + width, 0)
               line(0, -TY, 0, height - TY)

               let ymin = -ceil((height - TY) / ESCALA)
               let ymax = -Math.floor(-TY / ESCALA)

               let coef_escala = ESCALA < 20 ? ESCALA < 10 ? 5 : 2 : 1

               textAlign(RIGHT, CENTER)

               for (let i = ymin; i <= ymax; i += coef_escala) {
                    let p = TL_point(0, i)
                    push()
                    noStroke()
                    circle(p.x, p.y, 5)
                    if (i != 0) {
                         text(
                              round(-p.y / ESCALA),
                              TX - 15 <= 0 ? 15 - TX : TX >= width ? width - TX - 15 : p.x - 15,
                              p.y
                         )
                    }
                    pop()
                    push()
                    stroke(0, 0, 0, 30)
                    if (i != 0) {
                         line(-TX, p.y, -TX + width, p.y)
                    }
                    pop()
               }
               xmin = Math.floor(-TX / ESCALA)
               xmax = Math.floor((width - TX) / ESCALA)
               for (let i = xmin; i <= xmax; i += coef_escala) {
                    let p = TL_point(i, 0)
                    push()
                    noStroke()
                    circle(p.x, p.y, 5)
                    if (i != 0) {
                         text(
                              round(p.x / ESCALA),
                              p.x,
                              TY <= 0 ? - TY + 15 : TY >= height ? height - TY - 15 : p.y + 15
                         )
                    }
                    pop()
                    push()
                    stroke(0, 0, 0, 30)
                    if (i != 0) {
                         line(p.x, -TY, p.x, height - TY)
                    }
                    pop()
               }
               push()
               stroke("red")
               {
                    let pxmin = TL_point(xmin - 1, Fx(xmin - 1))
                    let pxmax = TL_point(xmax + 1, Fx(xmax + 1))
                    line(pxmin.x, pxmin.y, pxmax.x, pxmax.y)
               }
               pop()
               push()
               stroke("blue")
               beginShape()
               for (const p of puntos_dispersos) {
                    let v = TL_point(p.x, p.y)
                    circle(v.x, v.y, 5)
                    vertex(v.x, v.y)
               }
               noFill()
               stroke(0, 0, 0, 100)
               endShape()
               pop()
               push()
               fill("red")
               let mx = mouseX - TX
               let my = mouseY - TY
               noStroke()
               let x = mx / ESCALA
               let y = Fx(x)
               if (mouseX < width / 2) {
                    textAlign(LEFT, CENTER)
                    text(`(${Math.floor(x * 100) / 100},${Math.floor(y * 100) / 100})`, mx + 10, my)
               } else {
                    textAlign(RIGHT, CENTER)
                    text(`(${Math.floor(x * 100) / 100},${Math.floor(y * 100) / 100})`, mx - 10, my)
               }
               circle(mx, my, 5)
               stroke(255, 0, 0, 100)
               let p = TL_point(x, y)
               line(mx, my, p.x, p.y)
               circle(p.x, p.y, 5)
               pop()
          }

          function TL_point(x, y) {
               let v = createVector(x, y)
               v.mult(ESCALA, -ESCALA)
               return v
          }


          puntos_dispersos = []
          let Fx
          let Fx2

          randomizarPuntosDispersos()

          function randomizarPuntosDispersos() {
               puntos_dispersos = []
               rm = Math.random() * 2 - 1
               rb = Math.random() * 6 - 3
               Fx2 = (x) => {
                    return rm * x + rb
               }
               for (let x = 1; x <= 10; x++) {
                    puntos_dispersos.push({ x, y: Fx2(x) + Math.random() * 5 - 2.5 })
               }
               Fx = regresion_lineal()
               document.getElementById("cantidad").value = puntos_dispersos.length
               console.log(document.getElementById("cantidad").value)
               actualizarDatosTablaHTML()
          }

          function regresion_lineal() {
               let x = y = xy = xx = 0
               let cantidad = puntos_dispersos.length

               for (i = 0; i < cantidad; i++) {
                    x += puntos_dispersos[i].x;
                    y += puntos_dispersos[i].y;
                    xy += puntos_dispersos[i].x * puntos_dispersos[i].y;
                    xx += puntos_dispersos[i].x ** 2;
               }

               a = ((cantidad * xy) - (x * y)) / ((cantidad * xx) - (x ** 2));

               b = (y - (a * x)) / cantidad;

               document.getElementById("resumen").innerHTML = `
               a=${Math.floor(a * 10000) / 10000}
               <br>
               b=${Math.floor(b * 10000) / 10000}
               <br>
               y=a
               <input type="number" id="independiente" style="width:100px" value="0" onchange="calculadora()" onkeyup="calculadora()">+b
               =<span id="dependiente">0</span>
               `
               calculadora() 

               return function (x) {
                    return b + a * x
               }
          }

          function calculadora() {
               document.getElementById('dependiente').innerHTML = Math.floor(
                    (a * Number(document.getElementById('independiente').value) + b) * 100
               ) / 100
          }

          function leerTablaHTML() {
               let n = Number(document.getElementById("cantidad").value)
               puntos_dispersos = []
               for (let i = 0; i < n; i++) {
                    let x = Number(document.getElementById(`x-${i}`).innerHTML)
                    let y = Number(document.getElementById(`y-${i}`).innerHTML)
                    puntos_dispersos.push({ x, y })
               }
          }


          function actualizarDatosTablaHTML() {
               html = ``
               let n = Number(document.getElementById("cantidad").value)
               for (let i = 0; i < n; i++) {
                    p = puntos_dispersos[i] ?? { x: 0, y: 0 }
                    html += `<tr>`
                    html += `<td id="x-${i}" contenteditable="true" onfocus="selectElementContents(this)">`
                    html += Math.floor(p.x * 100) / 100
                    html += `</td>`
                    html += `<td id="y-${i}" contenteditable="true" onfocus="selectElementContents(this)">`
                    html += Math.floor(p.y * 100) / 100
                    html += `</td>`
                    html += `</tr>`
               }
               html += `
               <tr>
                    <td colspan="2" style="background: black;" onclick="randomizarPuntosDispersos()">
                         <span class="btn btn-primary">
                              <i class="fas fa-random"></i>
                         </span>
                    </td>
               </tr>
               `
               document.getElementById("dispersion").innerHTML = html
               for (let i = 0; i < n; i++) {
                    document.getElementById(`x-${i}`).addEventListener("DOMCharacterDataModified", actualizarDatos)
                    document.getElementById(`y-${i}`).addEventListener("DOMCharacterDataModified", actualizarDatos)
                    document.getElementById(`x-${i}`).addEventListener("keydown", keyDown)
                    document.getElementById(`y-${i}`).addEventListener("keydown", keyDown)
               }

               function keyDown(evt) {
                    if (evt.keyCode < 48 || evt.keyCode > 57) {
                         switch (evt.keyCode) {
                              case 8://Backspace
                              case 9://TAB
                              case 45://- (menos)
                              case 46://. (punto)
                              case 16://SHIFT
                              case 25://FIN
                              case 36://INICIO
                              case 37://LEFT
                              case 39://RIGHT
                                   break
                              default:
                                   evt.preventDefault();
                                   break
                         }
                    }
               }

               function actualizarDatos() {
                    leerTablaHTML()
                    Fx = regresion_lineal()
               }

               leerTablaHTML()
               Fx = regresion_lineal()
          }

          function selectElementContents(element) {
               var range = document.createRange();
               range.selectNodeContents(element);
               var sel = window.getSelection();
               sel.removeAllRanges();
               sel.addRange(range);
          }


     </script>

</body>

</html>